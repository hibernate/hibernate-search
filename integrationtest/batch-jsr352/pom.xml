<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
    <modelVersion>4.0.0</modelVersion>
    <parent>
        <groupId>org.hibernate.search</groupId>
        <artifactId>hibernate-search-integrationtest</artifactId>
        <version>6.0.0-SNAPSHOT</version>
    </parent>
    <artifactId>hibernate-search-integrationtest-batch-jsr352</artifactId>

    <name>Hibernate Search Integration Tests - Batch JSR-352</name>
    <description>Hibernate Search integration tests for the Batch JSR-352 integration</description>

    <properties>
        <!-- TODO HSEARCH-4043 Test settings for JDK 8 && RestartChunkIT (which uses Byteman) -->
        <surefire.jvm.args>${surefire.jvm.args.memory} ${surefire.jvm.args.java-version} ${surefire.jvm.args.jacoco} -Dcom.sun.xml.bind.v2.bytecode.ClassTailor.noOptimize=true</surefire.jvm.args>
        <failsafe.jvm.args>${surefire.jvm.args.memory} ${surefire.jvm.args.java-version} ${failsafe.jvm.args.jacoco} ${failsafe.jvm.args.hibernate-orm} -Dcom.sun.xml.bind.v2.bytecode.ClassTailor.noOptimize=true</failsafe.jvm.args>
    </properties>

    <dependencyManagement>
        <dependencies>
            <dependency>
                <groupId>org.mockito</groupId>
                <artifactId>mockito-core</artifactId>
                <version>${version.org.mockito}</version>
                <exclusions>
                    <!-- Bytebuddy is already imported by Hibernate ORM with a different version -->
                    <exclusion>
                        <groupId>net.bytebuddy</groupId>
                        <artifactId>byte-buddy</artifactId>
                    </exclusion>
                </exclusions>
            </dependency>
        </dependencies>
    </dependencyManagement>

    <dependencies>
        <dependency>
            <groupId>org.hibernate.search</groupId>
            <artifactId>hibernate-search-batch-jsr352-core</artifactId>
            <scope>test</scope>
        </dependency>
        <dependency>
            <groupId>org.hibernate.search</groupId>
            <artifactId>hibernate-search-util-internal-integrationtest-mapper-orm</artifactId>
            <scope>test</scope>
        </dependency>

        <dependency>
            <groupId>org.hibernate.search</groupId>
            <artifactId>hibernate-search-backend-lucene</artifactId>
            <scope>test</scope>
        </dependency>
        <dependency>
            <groupId>org.hibernate.search</groupId>
            <artifactId>hibernate-search-backend-elasticsearch</artifactId>
            <scope>test</scope>
        </dependency>

        <!--
            Leave this dependency here, not in a utils module, so that we don't need to recompile
            the utils to re-run the tests with a different database.
         -->
        <dependency>
            <groupId>${jdbc.driver.groupId}</groupId>
            <artifactId>${jdbc.driver.artifactId}</artifactId>
            <scope>test</scope>
        </dependency>

        <dependency>
            <groupId>com.ibm.jbatch</groupId>
            <artifactId>com.ibm.jbatch-runtime</artifactId>
            <version>${version.com.ibm.jbatch}</version>
            <scope>test</scope>
        </dependency>
        <!--
            JBatch doesn't provide a transitive dependency to the JSR-352 API, go figure.
         -->
        <dependency>
            <groupId>javax.batch</groupId>
            <artifactId>javax.batch-api</artifactId>
            <scope>test</scope>
        </dependency>
        <!--
            JBatch doesn't provide a transitive dependency to javax.inject, go figure.
         -->
        <dependency>
            <groupId>javax.inject</groupId>
            <artifactId>javax.inject</artifactId>
            <scope>test</scope>
        </dependency>
        <!--
            JBatch requires a database in order to work, and it seems it uses SQL that won't work with H2.
            Anyway, it uses an embedded Derby instance by default, so we just put the Derby driver in the classpath
            so it won't complain.
         -->
        <dependency>
            <groupId>org.apache.derby</groupId>
            <artifactId>derby</artifactId>
            <version>${version.org.apache.derby}</version>
            <scope>test</scope>
        </dependency>
    </dependencies>

    <build>
        <testResources>
            <testResource>
                <filtering>true</filtering>
                <directory>src/test/resources</directory>
            </testResource>
        </testResources>
        <plugins>
            <plugin>
                <groupId>org.apache.maven.plugins</groupId>
                <artifactId>maven-failsafe-plugin</artifactId>
                <executions>
                    <execution>
                        <id>it</id>
                        <goals>
                            <goal>integration-test</goal>
                            <goal>verify</goal>
                        </goals>
                    </execution>
                </executions>
            </plugin>
        </plugins>
    </build>

</project>

